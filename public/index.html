<!doctype html>
<html>

<head>
    <title>Timer</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
</head>

<body>
    <input id="value" autocomplete="off" placeholder="minute" />
    <input id="group" autocomplete="off" placeholder="group name" />
    <input id="time" autocomplete="off" placeholder="time" />
    
    <button id="add">Add</button>
    <button id="sub">Subtract</button>
    <button id="refresh">Refresh</button>
    <button id="start">Start</button>
    <button id="reset">Stop</button> 
    <button id="settime">Set</button> 
     
    <table id="table" style="width:100%; text-align:center">
      <tr>
        <th>Group</th>
        <th>Time</th>
      </tr>
      <tr>
        <td class="groupName">A</td>
        <td id="gpa"></td>
      </tr>
      <tr>
        <td class="groupName">B</td>
        <td id="gpb"></td>
      </tr>
      <tr>
        <td class="groupName">C</td>
        <td id="gpc"></td>
      </tr>
      <tr>
        <td class="groupName">D</td>
        <td id="gpd"></td>
      </tr>
      <tr>
        <td class="groupName">E</td>
        <td id="gpe"></td>
      </tr>
      
    </table>

    <script src="/socket.io/socket.io.js"></script>

    <script>
    var socket = io();
    $('#start').click(function() {
        socket.emit('start', {});
        return false;
    });
    $('#add').click(function() {
        var packet = {};
        packet.group = $("#group").val();
        packet.value = $('#value').val();
        socket.emit('add', packet);
        return false;
    });
    $('#sub').click(function() {
        var packet = {};
        packet.group = $("#group").val();
        packet.value = $('#value').val();
        socket.emit('sub', packet);
        return false;
    });

    $('#refresh').click(function(){
      socket.emit('refresh', {});
    })

    $('#reset').click(function(){
      socket.emit('reset', {});
    })
    $('#settime').click(function(){
      socket.emit('time', $('#time').val());
    })
    socket.on('update', function(obj_raw){
      showTime(obj_raw);
           
    });

    function showTime(obj_raw){
      var obj = {};
       
      function hour(time){
        var hour =  Math.floor((time/(1000*60*60))%24);
        return hour.toString();
      }
      function minute(time){
        var minute = Math.floor((time/(1000*60))%60);
        return minute.toString();
      }
      function second(time){
        var second =  Math.floor((time/1000)%60);
        return second.toString();
      }

      Object.keys(obj_raw).forEach(function(group) {
        if (obj_raw[group] > 0) {
          obj[group] = hour(obj_raw[group])+" : "+minute(obj_raw[group])+" : "+second(obj_raw[group]);
        } else {
          obj[group] = "Time Out";
        }
      })
      
      output(obj);
    }

    function output(obj){
      $("#gpa").html(obj.gpa);
      $("#gpb").html(obj.gpb);
      $("#gpc").html(obj.gpc);
      $("#gpd").html(obj.gpd);
      $("#gpe").html(obj.gpe)
    }

    $(".groupName").click(function(event){
      $("#group").val(event.target.innerHTML.toLowerCase());
    });

    </script>
</body>

</html>
